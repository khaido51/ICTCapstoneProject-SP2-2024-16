@{
    ViewData["Title"] = "Detecting of Onset Of Cysbersicknees using Physiological Cues";
    ViewData["Title2"] = "GSR Report From GSR Controller";
}
<div class="container px-4">
    <div class="row gx-4 center justify-content-center align-items-center">
        <div class="col-lg-8 text-center text-center">
            <h1>@ViewData["Title"]</h1>

        </div>
    </div>
</div>





<style>
    /*  body {
                  margin-top: 4rem;
                  margin-right: 5rem;
                  margin-left: 5rem;
                } */
    .name-1 {
        width: fit-content;
        padding: 1rem 2rem 0.5rem 2rem;
    }

    .list-inline p {
        font-size: 20px;
        font-weight: 500;
    }

    .list-inline-item {
        padding: 1rem 5rem 1rem 4rem;
    }

    .scene-name {
        font-size: 20px;
        font-weight: 500;
        padding-left: 2rem;
        margin-left: 2.5rem;
        width: 100px;
    }

    .cont-2 {
        padding-left: 1.25rem;
        margin-bottom: 1.5rem;
    }

    .form-check {
        padding-left: 4rem; /* Adjusted padding */
    }
</style>
<section id="participant">
    <div class="container mt-3 mb-2 px-4">
        <div class="row gx-4 justify-content-center">
            <div class="col-lg-8">
                <h2>@ViewData["Title2"]</h2>
                <ul class="list-inline">
                    <div class="name-1"><p>Paritipant</p></div>
                    <li class="list-inline-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="single" />
                            <label class="form-check-label" for="single"> Single </label>
                        </div>
                    </li>
                    <li class="list-inline-item">
                        <div class="form-check">
                            <input class="form-check-input"
                                   type="checkbox"
                                   id="Multiple" />
                            <label class="form-check-label" for="Multiple">
                                Multiple
                            </label>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</section>
<section id="scene">
    <div class="container px-4">
        <div class="row gx-4 justify-content-center">
            <div class="col-lg-8">
                <div>
                    <div class="container cont-2">
                        <div class="row">
                            <div class="col-2 d-flex align-items-center justify-content-center">
                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           id="passive" />
                                    <label class="form-check-label" for="passive">
                                        Shimmer
                                    </label>
                                </div>
                            </div>

                            <div class="col-4 d-flex align-items-center justify-content-center">
                                <form method="post"
                                      id="uploadPassiveForm"
                                      enctype="multipart/form-data"
                                      asp-controller="GSR"
                                      asp-action="Index">
                                    <div class="col-md-auto d-flex align-items-center justify-content-center">
                                        <input type="file" name="file" class="form-control" />
                                    </div>
                                </form>
                            </div>
                            <div class="col-2 d-flex align-items-center justify-content-center">
                                <input type="submit"
                                       form="uploadPassiveForm"
                                       value="Upload File"
                                       class="btn btn-primary" />
                            </div>
                        </div>
                    </div>
                </div>

                
            </div>
        </div>
    </div>
</section>
<!--
<div class="container px-4">
    <div class="row gx-4 justify-content-center">
        <div class="col-lg-10">
            @if (Model.Count > 0)
            {
                <hr />
                <table cellpadding="0" cellspacing="0" border="1">
                    <style>
                        table,
                        th,
                        td {
                            border: 1px solid black;
                            border-collapse: collapse;
                        }
                        /* setting the text-align property to center*/
                        td {
                            padding: 5px;
                            text-align: center;
                        }
                    </style>
                    <tr>
                        <td>Ms</td>
                        <td>No_Units</td>
                        <td>uS</td>
                        <td>kOhms</td>
                        <td>mV</td>
                    </tr>
                    @foreach (GSR gsrReport in Model)
                    {
                        <tr>

                            <td>@gsrReport.ms</td>
                            <td>@gsrReport.noUnits</td>
                            <td>@gsrReport.uS</td>
                            <td>@gsrReport.kOhms</td>
                            <td>@gsrReport.mV</td>
                         
                        </tr>
                    }
                </table>
            }
        </div>
    </div>
</div>
-->

@if (TempData["message"] != null)
{
    <script>alert('@TempData["message"]');</script>    
}

<body>
    <div id="chart-container"></div>
    <div id="slider-range"></div>


    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>
    <style>
        .bar {
            fill: navy;
        }
    </style>
<script>
    //Set dimensions and margins for the chart

        const margin = { top: 70, right: 30, bottom: 40, left: 80 };
        const width = 1200 - margin.left - margin.right;
        const height = 500 - margin.top - margin.bottom;

        // Set up the x and y scales
        const x = d3.scaleTime().range([0, width]);
        const y = d3.scaleLinear().range([height, 0]);

        // Create the SVG element and append it to the chart container
        const svg = d3.select("#chart-container")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Dataset conversion
        var gsrReport = @Html.Raw(Json.Serialize(Model));
        console.log(gsrReport);

        gsrReport.forEach(function (d) {
            d.tSpan = new Date(d.tSpan); // Convert to Date object
            d.noUnits = +d.noUnits;
            d.uS = +d.uS;
            d.kOhms = parseFloat(d.kOhms);
            d.mV = parseFloat(d.mV);
        });

        /*
        function calculateXDomain(gsrReport) {
            const minTspan = d3.min(gsrReport, d => d.tSpan);
            const maxTspan = d3.max(gsrReport, d => d.tSpan);
            // Convert milliseconds to minutes
            const tSpanRange = (maxTspan - minTspan) / (60 * 1000);
            console.log(tSpanRange);
            return [0, tSpanRange];
        }

        // Calculate the x domain
        const xDomain = calculateXDomain(gsrReport);

        // Set the x domain
        x.domain(xDomain);
        y.domain([0, d3.max(gsrReport, s => s.uS)]);

        // Update the x-axis scale accordingly
        svg.append("g")
            .attr("class", "x-axis")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x)
                .ticks(11)// Set the number of ticks to match the range of tSpan values
                .tickFormat((d, i) => {
                    if (i === 0) return "0";
                    const hour = i;
                    const paddedHour = hour.toString().padStart(2, "0");
                    return `${paddedHour}:00`;
                }));

        // Ensure the x-axis ticks start from 0
        svg.select(".x-axis")
            .selectAll(".tick")
            .each(function (d, i) {
                if (i === 0) {
                    d3.select(this).remove(); // Remove the first tick if it's not at 0
                }
            });

        
        // Add the y-axis
        svg.append("g")
            .attr("class", "y-axis")
            .call(d3.axisLeft(y));

        // Log the x and y domains to verify their values
        console.log("x domain:", x.domain());
        console.log("y domain:", y.domain());

        // Create the line generator
        const msLine = d3.line()
            .x((d, i) => x(i)) // Use the index 'i' as x-coordinate
            .y(s => y(s.uS));
        */

        // Define the x and y domains
        x.domain(d3.extent(gsrReport, s => s.tSpan));
        y.domain([0, d3.max(gsrReport, s => s.uS)]);

        console.log("x domain:", x.domain());
        console.log("y domain:", y.domain());
        // Add the x-axis
        svg.append("g")
            .attr("class", "x-axis")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x)
                .ticks(d3.timeMinute.every(1))
                .tickFormat(d3.timeFormat("%M:%S")));

        // Add the y-axis
        svg.append("g")
            .attr("class", "y-axis")
            .call(d3.axisLeft(y));

        // Create the line generator
        const msLine = d3.line()
            .x(s => x(s.tSpan))
            .y(s => y(s.uS));
        // Log the line data to see if it's correctly generated
        console.log("Line data:", gsrReport.map((d, i) => [i, d.uS]));
        // Add the line to the SVG
        svg.append("path")
            .datum(gsrReport)
            .attr("class", "line")
            .attr("fill", "none")
            .attr("stroke", "steelblue")
            .attr("stroke-width", 3)
            .attr("d", msLine);

        // Slider configuration
        const sliderRange = d3
            .sliderBottom()
            .min(d3.min(gsrReport, d => d.tSpan))
            .max(d3.max(gsrReport, d => d.tSpan))
            .width(300)
            .tickFormat(d3.timeFormat("%M:%S"))
            .ticks(3)
            .default([d3.min(gsrReport, d => d.tSpan), d3.max(gsrReport, d => d.tSpan)])
            .fill('#85bb65');

        sliderRange.on('onchange', val => {
            // Update x domain based on slider value
            x.domain(val);

            // Filter data based on slider value
            const filteredData = gsrReport.filter(d => d.tSpan >= val[0] && d.tSpan <= val[1]);

            // Update the line generator function
            const line = d3.line()
                .x(d => x(d.tSpan))
                .y(d => y(d.uS));

            // Update y domain based on filtered data
            y.domain([0, d3.max(filteredData, d => d.uS)]);

            // Update the x-axis
            svg.select(".x-axis")
                .call(d3.axisBottom(x)
                    .ticks(d3.timeMinute.every(1))
                    .tickFormat(d3.timeFormat("%M:%S")));

            // Update the y-axis
            svg.select(".y-axis")
                .call(d3.axisLeft(y));

            // Update the line
            svg.select(".line")
                .datum(filteredData)
                .attr("d", line);
        });

        // Append the slider to the container
        const gRange = d3
            .select('#slider-range')
            .append('svg')
            .attr('width', 500)
            .attr('height', 100)
            .append('g')
            .attr('transform', 'translate(90,30)');

        gRange.call(sliderRange);

       
</script>
</body>